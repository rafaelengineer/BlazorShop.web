@page "/Produtos"
@inject IProdutoService produtoService

<h2>Products Page</h2>


@if (Products == null)
{
    //<ExibirSpinner />
    <h3>Carregando Produtos...</h3>
}
else
{
    var genericPic = @"https://localhost:7110/Imagens/AutoParts/AutoParts30.png";
    <h3 class="mb-5">Produtos</h3>
    @if (Products.Count() > 0)
    {
        <div class="row mt-3">
            @foreach (var item in Products)
            {
                <div class="col-md3-mb2">
                    <a href="#">
                        <div class="card" style="width: 18rem;">
                            <div class="card-body">
                                @if (!string.IsNullOrEmpty(item.ImagemUrl))
                                {
                                    <img src="@item.ImagemUrl" class="img-thumbnail" />
                                }
                                else
                                {
                                    <img src=https://localhost:7110/Imagens/AutoParts/AutoParts30.png class="img-thumbnail" />
                                    <p>No Image Available at @item.Manufacturer</p>
                                }
                                <h5 class="card-title mb-3">@item.CategoryName.ToString()</h5>
                                <h5 class="card-title mb-3">@item.Price.ToString("c")</h5>
                            </div>
                        </div>
                    </a>
                </div>
            }
        </div>
    }
    <h4>@teste</h4>
    @*  @*   <h3 class="mb-5">Produtos</h3>
      @if (Produtos.Count() > 0)
      {
          var produtosPorCategoria = from produto in Produtos
                                     group produto by produto.CategoryId into prodPorCatGrupo
                                     orderby prodPorCatGrupo.Key
                                     select prodPorCatGrupo;

          @foreach (var prodGrupo in produtosPorCategoria)
          {
              <h4>@prodGrupo.FirstOrDefault(pg=> pg.CategoryId == prodGrupo.Key).CategoryName</h4>
              <div class="row mt-3">
                  <ExibirProdutos Produtos="@prodGrupo"></ExibirProdutos>
              </div>
              <hr class="mb-2"/>
          }
      }
 }
*@

    @code {
    public IEnumerable<Product_DTO> Products { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Products = await produtoService.GetItens();
        int test = 0;
    }
    public string teste = "fim do código";
    //public IEnumerable<Product_DTO> Products { get; set; }
    //
    //protected override async Task OnInitializedAsync()
    //{
    //    Products = await produtoService.GetItens();
    //}
    }

    @*[Inject]
    public IGerenciaProdutosLocalStorageService?
                 GerenciaProdutosLocalStorageService
    { get; set; }

    [Inject]
    public IGerenciaCarrinhoItensLocalStorageService?
                 GerenciaCarrinhoItensLocalStorageService
    { get; set; }

    [Inject]
    public ICarrinhoCompraService? CarrinhoCompraService { get; set; }

    public string? MensagemErro { get; set; }


    protected override async Task OnInitializedAsync()
    {
        try
        {
            await LimpaLocalStorage();

            Produtos = await GerenciaProdutosLocalStorageService.GetCollection();

            var carrinhoCompraItens = await GerenciaCarrinhoItensLocalStorageService
                                           .GetCollection();

            var totalQuantidade = carrinhoCompraItens.Sum(i => i.qtd);

            CarrinhoCompraService.RaiseEventOnCarrinhoCompraChanged(totalQuantidade);

        }
        catch (Exception ex)
        {
            MensagemErro = ex.Message;
        }
    }

    private async Task LimpaLocalStorage()
    {
        await GerenciaProdutosLocalStorageService.RemoveCollection();
        await GerenciaCarrinhoItensLocalStorageService.RemoveCollection();
    }*@
}
